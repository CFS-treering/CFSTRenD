---
  # title: "vignette_CFSTRenD"
title: "data report"

date: "`r Sys.Date()`"
output:
  html_document:
  theme: flatly
highlight: tango
# toc: true
# toc_depth: 4            # Define the depth of the TOC (increase as needed)
# toc_float:
#   collapsed: TRUE      # Whether the TOC starts collapsed
# smooth_scroll: true   # Smooth scrolling when a TOC entry is clicked
# 
# fontsize: 12pt              # Set font size
# linkcolor: blue             # Hyperlink color (for PDF output)
# subtitle: "generated by R Markdown"

# knitr:
#   opts_chunk: 
#     echo: false
    
    
---
```{r setup, include=FALSE}
# This chunk sets global options to hide all R code from appearing in the output
knitr::opts_chunk$set(echo = FALSE)
library(data.table)
library(CFSTRenD)
library(gt)
library(htmltools)
# library(ggplot2)
# library(sf)

# read ring measurement
 # samples69.o <- fread(system.file("extdata", "samples69.csv", package = "CFSTRenD"))
  # samples69.trt <- CFS_format(data = list(samples69.o, 39:140), out.csv = NULL)
  tr_long <- samples69.trt$tr_all_long
```


```{r, include = FALSE}
# knitr::opts_chunk$set(
# collapse = TRUE,
# comment = "#>"
# )
```
# Introduction

Project name: `r tr_long$tr_1_projects$project_name`
There's `r length(unique(tr_long$tr_3_trees$species))` species ( `r unique(tr_long$tr_3_trees$species)`) in this dataset. The count at each level:

```{r, warning=FALSE}
# library(gt)
# library(htmltools)
# library(data.table)
library(patchwork)

count_uid <- data.table(species = length(unique(tr_long$tr_3_trees$species)), projects = nrow(tr_long$tr_1_projects), sites = nrow(tr_long$tr_2_sites), tree = nrow(tr_long$tr_3_trees),
                        meas = nrow(tr_long$tr_4_meas), samples = nrow(tr_long$tr_5_samples), radiuses = nrow(tr_long$tr_6_radiuses))
gt_html <- gt(count_uid) %>% as_raw_html()
gt_html
```
## data summary

```{r}
spc.lst <- unique(tr_long$tr_3_trees$species)
tr_w6 <- samples69.trt$tr_all_wide[, c("uid_radius", "rw_yend", "rw_ystart", "latitude", "longitude", "species", "dbh_cm", "uid_tree","ht_tot_m")]
tr_7 <- merge(tr_w6, tr_long$tr_7_ring_widths, by ="uid_radius")
for (i.spc in seq_along(spc.lst)){
tr_6i <- tr_w6[species == spc.lst[i.spc]]
tr_7i <- tr_7[species == spc.lst[i.spc]]


p.ispc<- plots_ds(list(tr_6i, tr_7i))
    print(p.ispc)
    }
```


## variable completion


  This table is to present the completeness of each variable in percentage. 0 means no effective value.

```{r}
# library(gt)
# library(htmltools)

# Split the data into three blocks
split_dfs <- split(samples69.trt$complete_vars, cut(seq_len(nrow(samples69.trt$complete_vars)), breaks = 3, labels = FALSE))

# Generate gt tables
gt1_html <- gt(split_dfs[[1]]) %>% as_raw_html()
# %>%
# tab_header(title = "Block 1")
gt2_html <- gt(split_dfs[[2]]) %>% as_raw_html() 
# %>%
# tab_header(title = "Block 2")
gt3_html <- gt(split_dfs[[3]]) %>% as_raw_html() 
# %>%
# tab_header(title = "Block 3")



# Render tables as raw HTML
# gt1_html <- gt1 %>% as_raw_html()
# gt2_html <- gt2 %>% as_raw_html()
# gt3_html <- gt3 %>% as_raw_html()



grid_layout <- tagList(
  tags$div(style = "display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;",
           tags$div(HTML(gt1_html)),
           tags$div(HTML(gt2_html)),
           tags$div(HTML(gt3_html))
  )
)

# Output the grid layout
grid_layout
# 
# knitr::kable(
#   list(split_dfs[[1]], split_dfs[[2]]),
#   caption = 'Two tables placed side by side.',
#   booktabs = TRUE, valign = 't'
# )

```
