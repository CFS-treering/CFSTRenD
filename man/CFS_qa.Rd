% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/quality_assessment.R
\name{CFS_qa}
\alias{CFS_qa}
\title{Crossdating Field Season Quality Assurance Analysis}
\usage{
CFS_qa(
  dt.input,
  qa.label_data = "",
  qa.label_trt = "",
  qa.max_lag = 10,
  qa.max_iter = 100,
  qa.min_nseries = 100,
  qa.blcrit = 0.1,
  qa.mem_target = 0.6
)
}
\arguments{
\item{dt.input}{A data.table containing tree-ring measurements with required columns:
\describe{
  \item{species}{Character. Species identifier (must be single species)}
  \item{SampleID}{Character/Integer. Unique sample identifier}
  \item{Year}{Integer. Year of measurement}
  \item{RawRing}{Numeric. Raw ring-width measurement}
  \item{RW_trt}{Numeric. Treated/detrended ring-width series}
}}

\item{qa.label_data}{Character. Label identifier for the dataset (required)}

\item{qa.label_trt}{Character. Label identifier for the treatment method (required)}

\item{qa.max_lag}{Integer. Maximum lag for cross-correlation analysis (default: 10)}

\item{qa.max_iter}{Integer. Maximum iterations for chronologies refinement (default: 100)}

\item{qa.min_nseries}{Integer. Minimum number of series required (default: 100)}

\item{qa.blcrit}{Numeric. Borderline threshold criterion for quasi-pass classification (default: 0.1)}

\item{qa.mem_target}{Numeric. Proportion of free memory to use for batch processing
(0-1, default: 0.6). Higher values use more memory but may be faster.}
}
\value{
An object of class \code{cfs_qa} containing:
  \describe{
    \item{dt.ccf}{data.table with CCF results and QA codes for each sample}
    \item{dt.chron}{data.table with chronologies statistics}
    \item{dt.stats}{data.table with summary statistics per radius}
    \item{dt.plots}{List of data.tables formatted for plotting (raw and treated series, CCF plots)}
    \item{qa.parms}{List of QA parameters used in the analysis}
  }
}
\description{
Performs comprehensive quality assurance analysis for tree-ring crossdating
using pairwise cross-correlation functions and iterative chronologies
refinement with automatic memory-efficient batch processing.
}
\details{
The function performs a two-step quality assurance process:

\strong{Step 1: Pairwise Cross-Correlation}
\itemize{
  \item Computes CCF for all pairs of treated series
  \item Uses auto-batching to manage memory efficiently
  \item Identifies initial candidate samples with max CCF at lag 0
}

\strong{Step 2: Iterative chronologies Refinement}
\itemize{
  \item Computes chronologies from candidate samples
  \item Evaluates each sample against the chronologies
  \item Iteratively refines sample list until convergence
}

\strong{QA Code Classification:}
\itemize{
  \item \code{pass}: Maximum correlation at lag 0
  \item \code{borderline}: Second highest correlation at lag 0 (within threshold)
  \item \code{pm1}: Maximum correlation at lag Â±1 (slight misalignment)
  \item \code{highpeak}: Maximum at non-zero lag, >2x second highest
  \item \code{fail}: All other cases
}

\strong{Auto-batching:}
The function automatically determines optimal batch size based on:
\itemize{
  \item Available system memory
  \item Number of CPU cores
  \item Estimated memory per CCF operation
  \item Safety margins to prevent out-of-memory errors
}
}
\examples{
\dontrun{
# Prepare your tree-ring data
dt.input <- data.table(
  species = "PIPO",
  SampleID = rep(1:150, each = 100),
  Year = rep(1900:1999, 150),
  RawRing = rnorm(15000, 2, 0.5),
  RW_trt = rnorm(15000, 0, 0.3)
)

# Run QA analysis with auto-batching
result <- CFS_qa(
  dt.input = dt.input,
  qa.label_data = "Site_A_2024",
  qa.label_trt = "Spline_Detrend",
  qa.max_lag = 10,
  qa.mem_target = 0.6  # Use 60\% of free memory
)

# Examine results
summary(result$dt.ccf)
table(result$dt.ccf$qa_code)
print(result$dt.chron)
}

}
\references{
Add relevant references for crossdating methodology
}
\seealso{
\code{\link{ccf}} for cross-correlation function
}
